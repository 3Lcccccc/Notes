# 4.1 文件系统基础
## 4.1.1 文件的概念
### 1. 文件的属性

1. 名称
2. 标识符
3. 类型
4. 位置
5. 大小
6. 保护
7. 时间、日期、和用户标识

### 2. 文件的基本操作

1. 创建文件(create系统调用)
   1. 
2. 删除文件(delete系统调用)
3. 读文件(read系统调用)
4. 写文件(write系统调用)
5. 打开文件(open系统调用)
6. 关闭文件(close系统调用)

## 4.1.2 文件的逻辑结构

1. 无结构文件(流式文件)
   - 由一系列二进制或字符流组成
2. 有结构文件(记录式文件又分为定长记录和变成记录)
   1. 顺序文件
      1. 文件中的记录一个接一个地顺序排列(逻辑上)，记录可以是**定长**的或**可变长**的。各个记录在物理上可以**顺序存储**或**链式存储**
      2. 串结构：记录之间的顺序与关键字无关
      3. 顺序结构：记录之间的顺序按关键字排列
      4. ![](2021-07-05-10-31-40.png)
      5. ![](2021-07-05-10-31-49.png)
   2. 索引文件
      1. 建立一个索引表(索引号、长度、指针)
      2. 索引表本身是定长记录的顺序文件
      3. 主要用于对信息处理的及时性要求比较高的场合
      4. 👎缺点：索引表会占用而外的存储空间
   3. 索引顺序文件
      1. 将记录分组。每组对应一个索引表项
   4. 直接文件或散列文件    

## 4.1 目录结构

### 1. 文件控制块和索引结点
1. 文件控制块(FCB)
   1. 基本信息：文件名、文件的物理位置...
   2. 存取控制信息：存取权限...
   3. 使用信息：建立、修改信息...
2. 索引结点(FCB的改进)
   1. 把除了文件名以外的数据存到索引结点中，增加一个索引结点指针，降低读盘次数(目录表大小减小)，提高查询速度。

### 2. 目录结构
- 搜索
- 创建文件
- 删除文件
- 显示目录
- 修改目录
1. 单级目录结构
   - 实现了按名存取，但**不允许重名**
2. 两级目录结构
   - 早期多用户系统采用，用户不能对自己的文件进行分类
3. 多级目录结构(树形目录结构)
   - 不便于实现文件的共享
4. 无环图目录结构
   - 可以用不同的文件名指向同一个文件，甚至目录。需要为每个共享结点设置一个共享计数器。
   - ⚠️不同于复制文件，共享文件只要有一个用户修改了文件数据，那么所有用户都可以看到文件数据的变化。

## 4.1.4 文件共享

# 4.2 文件系统实现
## 4.2.1 文件系统层次结构
## 4.2.2 目录实现
## 4.2.3 文件实现——文件分配方式
**访问的两个磁盘块越远，所需(移动磁头)时间越长**
1. 连续分配
   1. 要求每个文件在磁盘上占有一组连续的块
   2. 文件目录中记录存放的起始块号和长度
   3. 👍优点：
      1. 支持顺序、随机访问
      2. 在顺序读/写速度最快
   4. 👎缺点：
      1. 不方便拓展
      2. 空间利用率低
2. 链接分配(题目中没有提及默认为隐式)
   1. 利用指针链接磁盘块
   2. 隐式
      1. 目录中记录起始块号和结束块号
      2. 👍优点：
         1. 拓展文件方便
         2. 外存利用率高
      3. 👎缺点：
         1. 只支持顺序访问，不支持随机访问
         2. 指针也需要耗费存储空间 
   3. 显式
      1. 把链接关系存放在一张文件分配表(FAT)中
      2. 一个磁盘仅设置一张FAT，开机时将其存入内存，且常驻内存。
      3. 👍优点：
         1. 支持顺序、随机访问
         2. 方便文件拓展
      4. 👎缺点：
         1. FAT也会占用内存
3. 索引分配