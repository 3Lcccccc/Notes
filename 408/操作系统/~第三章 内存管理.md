# 3.1 内存管理概念
## 3.1.1 内存管理的基本原理和要求

**内存管理的功能**
1. 内存空间的分配与回收
2. 地址转换
3. 内存空间的扩充
4. 存储保护


***
### 1.程序装入和链接
1. 编译
2. 链接
   - 由链接程序将编译后形成的一组目标模块以及所需的库函数链接在一起，形成一个完整的装入模块。
3. 装入
- 链接的三种方式
   1. 静态链接
   2. 装入时动态链接
   3. 运行时动态链接
- 装入的三种方式
   1. 绝对装入(还没有操作系统)
   2. 可重定位装入(早期批处理操作系统)
      1. 装入时更改指令的地址
      2. 特点：装入时必须分配它要求的全部内存，若没有足够内存则不能装入。
   3. 动态运行时装入(现代操作系统)
      1. 全部为相对地址
      2. 特点：需要重定位寄存器
***
### 2.内存保护
让各个进程自己访问自己的内存空间
内存保护的两种方法
1. 设置上下限寄存器
2. 采用重定位寄存器和界地址寄存器(逻辑地址的上限)又称基址和限长寄存器

## 3.1.2 连续分配管理方式
1. 单一连续分配
   1. 内存被分为系统区(通常位于低地址)和用户区
   2. 内存中只能有一道程序，用户程序独占整个用户区
   3. 👍优点：实现简单、无外部碎片、可以采用覆盖技术扩充内存、不一定需要采取内存保护
   4. 👎缺点：只能用于单用户、单任务的操作系统中、有内部碎片、存储器利用率极低。
2. 固定分区分配
   1. 将用户区分成若干分区，每个分区只能装入一道作业
   2. 分区大小相等
      - 缺乏灵活性，但是很适用于用一台计算机控制多个相同对象的场合
   3. 分区大小不等
      1. 增加了灵活性，可以满足不同大小的进程需求
   4. 需要建立一个分区说明表来记录分区的大小、起始地址、状态
   5. 👍优点：实现简单、无外部碎片
   6. 👎缺点：
      1. 当用户程序太大时，可能所有的分区都不能满足，此时不得不采用覆盖技术来解决，但又会降低性能
      2. 会产生内部碎片，内存利用率低
3. 动态分区分配
   1. 在进程装入内存时根据进程的大小动态地建立分区
   2. 采用空闲分区表或链来记录分区信息
   3. 没有内部碎片，但是有外部碎片

内部碎片：分配给某进程的内存区域中，如果有些部分没有用上。
外部碎片：是指内存中的某些空闲分区由于大小而难以利用。

***

**动态分区分配算法**
1. 首次适应(FF)
   - 每次都从低地子开始查找，找到第一个能满足大小的空闲分区
2. 最佳适应(BF)
   - 优先使用小的空闲分区
   - 空闲分区按照容量递增排序
   - 👎缺点：每次都选最小的分区进行分配，会留下越来越多的、很小的、难已利用的内存块。因此这种方法会产生很多的外部碎片。
3. 最坏适应(WF)
   - 优先利用最大的空闲分区
   - 👎缺点：每次都选最大的分区进行分配，会导致较大的连续空闲区被迅速用完。之后又大进程到达，就没有内存分区可用了。
4. 邻近适应(NF)
   - 每一次查找都是从上次结束的位置开始
   - 👎缺点：高地址的大分区也会被用完

## 3.1.3 非连续分配管理方式
1. 基本分页存储管理方式
   1. 基本概念
      1. 将内存空间分成一个个大小相等的分区，每个分区就是一个页框(页桢、内存块、物理块、物理页面)，每个页框有一个编号，即页框号(从0开始)。
      2. 将进程的逻辑地址空间页分为与页框大小相等的一个个部分，每一个部分称为一个页(页面)。每个页面也有一个编号，即页号(从0开始)。
      3. 各个页面不必连续存储。
      4. **页表**
         1. 一个进程对应一个页表
         2. 进程中的每个页面对应一个页表项
         3. 每个页表项由页号和块号组成
         4. 页表通常储存在PCB中
         5. 页号是不需要占存储空间的因为页表项是连续存放的
         6.  **如果有$k$位表示"页内偏移量"，则说明该系统中一个页面的大小是$2^k$个内存单元**
         7.  **如果有$m$位表示"页号"，则说明该系统中，一个进程最多有$2^m$个页面。**
   2. 基本地址变化机构
      1. 计算页号和页内偏移量的值
      2. 比较页号和页表长度判断是否越界
      3. 根据页号取出页框号
      4. 计算物理地址
   3. 具有快表的地址变化机构
      1. 快表(又称联想寄存器 TLB)
         1. 一种访问速度**比内存快很多**的高速缓存(**不是内存**)，用来存放最近访问的页表项副本。
      2. 优先查询快表
      3. 如果快表没有命中再查询慢表并且把表项复制到快表中
   4. 两级页表
      1. 把页表分成n等份，再利用一个新的**页目录表**来记录这些小页表
      2. 若采用多级页表机制，则各级页表的大小不能超过一个页面