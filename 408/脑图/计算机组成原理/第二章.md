# 数据的表示和运算

## 定点数的表示与运算

- 小数转二进制
  - 乘$2$取整
  - 重复至没有小数
  - 由上至下，从高位至低位
- 定点小数
  - $X=x_0.x_1x_2\cdots x_n$
  - $x_0$为符号位$\qquad x_1$~$x_n$是数值的有效部分
  - 最大正值$1-2^{-n}$
  - 最小负值$-(1-2^{-n})$
- 转换
  - **真值**$\rightarrow$**原码**
    - 数值位不变 加符号位
  - **原码**$\leftrightarrow$**反码**
    - 符号不变
    - 负数 数值取反
  - **原码**$\leftrightarrow$**补码**
    - 符号不变
    - 负数 数值位取反加$1$(考虑进位)
  - **补码**$\leftrightarrow$**负补码**
    - 符号位取反
    - 数值位取反加$1$
  - **负补码**$\leftrightarrow$**原码**
    - 将最右边的$1$左侧的数取反(不包括符号位)
## 定点数的运算

### 定点数的移位运算
  - 算术移位
    - 正数
      - 空位都添$0$
    - 负数
      - 原数
        - 添$0$
      - 补码
        - 左移添$0$
        - 右移添$1$
      - 反码
        - 添$0$
  - 逻辑移位
    - 将操作数视为无符号数,空位都添$0$
  - 循环移位
    - 适合将数据的低字节数据与高字节数据互换
    - 带进位标志位
    - 不带进位标志位
### 原码定点数的加减法
  - 加法
    - 先判断符号位
    - 若相同，则绝对值相加
    - 不同，则绝对值大的减去绝对值小的，符号位与绝对值大的相同
  - 减法
    - 先将减数符号位取反
    - 然后按照加法进行计算
  - ⚠️:注意机器字长,当左边位出现溢出时,将溢出位丢弃
### 补码定点数加减法运算
  - $[A+B]=[A]+[B]$
  - $[A-B]=[A]+[-B]$
  - 并且舍弃溢出位
### 定点数的乘法
  - 原码一位乘法
    - 符号位与数值位**分开运算**
    - 符号位：两个数符号位**异或**
    - 数值部分：两个数的绝对值相乘之积(采用双符号位$00$)
      - 从乘数的最低位$y_n$开始判断
      - 若$y_n=1$则加上$|x|$，逻辑右移
      - 若$y_n=0$则加$0$，逻辑右移
      - 重复至乘数数值部分移动完
  - 补码一位乘法
    - 采用双符号位参加运算，初始值为00
    - 乘数末尾添加附加位$y_{n+1}=0$
    - 根据$y_n,y_{n+1}$来确定操作
      - $00$和$11$右移
      - $01$加$[x]$右移
      - $10$加$[-x]$右移
      - ⚠️$[-x]$的符号位也要变换
    - 重复$n+1$次,最后一次不需右移
### 定点数的除法运算
  - 原码除法
    - 商的符号位：两个数的符号位异或
    - 数值部分：$|Q|=|X|/|Y|$
    - $|Q|$运算规则
      - 符号位不参加运算
      - 先用被除数减去除数($|X|-|Y|=|X|+(-|Y|)=|X|+[-|Y|]_补$)
      - 余数(结果)为正时,商加$1$,商和余数左移,再减去除数
      - 余数为负时,商加$0$,商和余数左移,再加上除数
      - 当第$n+1$步余数为负时,需要加上$|Y|$得到正确的余数
  - 补码除法
    - 首先若被除数与除数**同号**,则被除数**减去除数**,若被除数与除数**异号**,则被除数**加上除数**
    - 3️⃣若余数与被除数**同号**,则商上$1$,余数和商左移,减去除数
    - 3️⃣若余数与被除数**异号**,则商上$0$,余数和商左移,加上除数
    - 重复3️⃣$n$次
    - 若对商没有精度要求,则一般采用"末位恒置$1$"法
### 溢出的概念和判别方式
  - 采用一位符号位
    - $V=ABS_反+A_反B_反S$
    - $V=0$无溢出
    - $V=1$溢出
  - 采用双符号位
    - $SS=00$无溢出
    - $SS=01$正溢出
    - $SS=10$负溢出
    - $SS=11$无溢出
    - 最高位代表真正的符号
## $C$语言中的整数类型及类型转换
  - 有符号数和无符号数的转换
    - 二进制位是一样的
  - 不同字长整数之间的转换
    - **大字节**$\leftarrow$**小字节**：多余高位直接截断
    - **小字节**$\rightarrow$**大字节**：保证数值相等的情况下补充高位

## 数据的存储和排列
- 数据的"大端方式"和"小端方式"存储
  - 大端方式：按从高到低位,即最高位存放在前面
  - 小端方式：按从低到高位,即最低位存放在前面
- 数据按"边界对齐"方式存储
  - 填充，满足每次取字节、半字还是字，均可以一次访存取出