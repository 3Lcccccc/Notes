# 5.1 传输层提供的服务

## 5.1.1 传输层的功能

1. 提供进程和进程之间的逻辑通信
2. 复用和分用
   1. 复用：发送方不同的应用进程都可以使用同一个传输层协议传送数据
   2. 分用：接收方的传送层在剥去报文的首部后能够把这些数据正确交付到目的应用进程
3. 传送层对收到的报文进行差错检验
4. 提供两种协议

## 5.1.2 传输层的寻址与端口

端口号长度为16bit

1. 服务端使用的端口号
   1. 熟知端口号(0~1023)：给TCP/IP的一些应用程序
   2. 登记端口号(1024~49151):为没有熟知端口号的应用程序使用
2. 客户端使用的端口号(49152~65535):仅在客户端进程运行时才动态选择

# 5.2 UDP协议

## 5.2.1 UDP数据报

### 1. UDP概述

UDP只在IP数据报服务之上增加了很少功能,即复用分用和差错检测功能

UDP的主要特点:
1. 无连接的,减少开销和发送数据之前的时延.
2. 使用最大努力交付,即不保证可靠交付
3. 面向报文,适合一次性传输少量数据的网络应用
4. 无拥塞控制,适合很多实时应用
5. 首部开销小 8B

### 2. UDP的首部格式

![](2021-08-11-23-15-07.png)

分用时,找不到对应的目的端口号, 就丢弃报文,并给发送方发送ICMP"端口不可达"差错报告报文

### 3. UDP校验

![](2021-08-11-23-19-15.png)

**在发送端**
1. 填上伪首部
2. 全0填充校验和字段
3. 全0填充数据部分(UDP数据报要看成许多4B的字串接起来)
4. 伪首部+首部+数据部分采用二进制反码求和
5. 把求和反码填入校验和字段
6. 去掉伪首部,发送

**在接收端**
1. 填上伪首部
2. 伪首部+首部+数据部分采用二进制反码求和
3. 结果全为1则无差错,否则丢弃数据报或者交给应用层附上出错的警告